<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë ˆë²¨í…ŒìŠ¤íŠ¸ - Gpters</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .level-test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .test-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .test-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .question-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .level-indicator {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .question-content h3 {
            color: #2c3e50;
            font-size: 1.3rem;
            line-height: 1.6;
            margin-bottom: 25px;
            white-space: pre-line;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .option-btn {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1rem;
        }
        
        .option-btn:hover {
            border-color: #3498db;
            background-color: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
        }
        
        .option-btn.selected {
            border-color: #3498db;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .option-letter {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            font-weight: 600;
            margin-right: 15px;
            font-size: 0.9rem;
        }
        
        .option-btn.selected .option-letter {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            min-width: 150px;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #2980b9, #1f4e79);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .btn-primary:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 40px;
            text-align: center;
        }
        
        .level-number {
            display: block;
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .score-details {
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .score-details p {
            margin: 8px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        @media (max-width: 768px) {
            .level-test-container {
                padding: 15px;
            }
            
            .test-header h1 {
                font-size: 2rem;
            }
            
            .question-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="level-test-container">
        <div class="test-header">
            <h1>ğŸ¯ ë ˆë²¨í…ŒìŠ¤íŠ¸</h1>
            <p>ë‹¹ì‹ ì˜ í”„ë¡œê·¸ë˜ë° ì‹¤ë ¥ì„ ì¸¡ì •í•´ë³´ì„¸ìš”!</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div id="questionCounter">1 / 12</div>
        </div>

        <div id="testContainer">
            <!-- í…ŒìŠ¤íŠ¸ ë¬¸ì œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
    </div>

    <script>
        // ë ˆë²¨í…ŒìŠ¤íŠ¸ ë¬¸ì œ ë°ì´í„°
        const testQuestions = [
            // Level 0 - ì´ˆë³´ì
            {
                id: 1,
                level: 0,
                question: "ë‹¤ìŒ ì¤‘ ë³€ìˆ˜ ì„ ì–¸ ë°©ë²•ì´ ì˜¬ë°”ë¥¸ ê²ƒì€?",
                options: [
                    "var name = 'John';",
                    "name = 'John';",
                    "let name = 'John';",
                    "const name = 'John';"
                ],
                correctAnswer: 2,
                explanation: "letê³¼ constëŠ” ES6ì—ì„œ ë„ì…ëœ ë¸”ë¡ ìŠ¤ì½”í”„ ë³€ìˆ˜ ì„ ì–¸ ë°©ë²•ì…ë‹ˆë‹¤."
            },
            {
                id: 2,
                level: 0,
                question: "JavaScriptì—ì„œ í•¨ìˆ˜ë¥¼ ì„ ì–¸í•˜ëŠ” ë°©ë²•ì€?",
                options: [
                    "function myFunc() {}",
                    "const myFunc = () => {}",
                    "var myFunc = function() {}",
                    "ëª¨ë‘ ì˜¬ë°”ë¦„"
                ],
                correctAnswer: 3,
                explanation: "JavaScriptì—ì„œëŠ” ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ì„ ì–¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
            },
            // Level 1 - ì‰¬ì›€
            {
                id: 3,
                level: 1,
                question: "ë‹¤ìŒ ì½”ë“œì˜ ì¶œë ¥ ê²°ê³¼ëŠ”?\n\nconst arr = [1, 2, 3];\nconsole.log(arr.length);",
                options: ["2", "3", "4", "undefined"],
                correctAnswer: 1,
                explanation: "ë°°ì—´ì˜ length ì†ì„±ì€ ë°°ì—´ì˜ ìš”ì†Œ ê°œìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤."
            },
            {
                id: 4,
                level: 1,
                question: "ë‹¤ìŒ ì¤‘ ë°°ì—´ ë©”ì„œë“œê°€ ì•„ë‹Œ ê²ƒì€?",
                options: ["push()", "pop()", "length()", "shift()"],
                correctAnswer: 2,
                explanation: "lengthëŠ” ë©”ì„œë“œê°€ ì•„ë‹Œ ì†ì„±ì…ë‹ˆë‹¤."
            },
            // Level 2 - ë³´í†µ
            {
                id: 5,
                level: 2,
                question: "ë‹¤ìŒ ì½”ë“œì˜ ì¶œë ¥ ê²°ê³¼ëŠ”?\n\nconst obj = { a: 1, b: 2 };\nconst { a, b } = obj;\nconsole.log(a + b);",
                options: ["3", "12", "undefined", "ì—ëŸ¬"],
                correctAnswer: 0,
                explanation: "êµ¬ì¡° ë¶„í•´ í• ë‹¹ì„ í†µí•´ ê°ì²´ì˜ ì†ì„±ì„ ë³€ìˆ˜ë¡œ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
            },
            {
                id: 6,
                level: 2,
                question: "Promiseì˜ ìƒíƒœê°€ ì•„ë‹Œ ê²ƒì€?",
                options: ["pending", "fulfilled", "rejected", "resolved"],
                correctAnswer: 3,
                explanation: "Promiseì˜ ìƒíƒœëŠ” pending, fulfilled, rejectedì…ë‹ˆë‹¤."
            },
            // Level 3 - ì–´ë ¤ì›€
            {
                id: 7,
                level: 3,
                question: "ë‹¤ìŒ ì½”ë“œì˜ ì¶œë ¥ ê²°ê³¼ëŠ”?\n\nasync function test() {\n  const result = await Promise.resolve(42);\n  return result * 2;\n}\ntest().then(console.log);",
                options: ["42", "84", "undefined", "Promise"],
                correctAnswer: 1,
                explanation: "async/awaitë¥¼ ì‚¬ìš©í•˜ì—¬ Promiseë¥¼ ì²˜ë¦¬í•˜ê³  ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤."
            },
            {
                id: 8,
                level: 3,
                question: "í´ë¡œì €(Closure)ì˜ íŠ¹ì§•ì´ ì•„ë‹Œ ê²ƒì€?",
                options: [
                    "ì™¸ë¶€ í•¨ìˆ˜ì˜ ë³€ìˆ˜ì— ì ‘ê·¼ ê°€ëŠ¥",
                    "ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°€ëŠ¥ì„±",
                    "ì „ì—­ ë³€ìˆ˜ì™€ ë™ì¼í•œ ìŠ¤ì½”í”„",
                    "í•¨ìˆ˜ê°€ ì„ ì–¸ëœ í™˜ê²½ì„ ê¸°ì–µ"
                ],
                correctAnswer: 2,
                explanation: "í´ë¡œì €ëŠ” ì™¸ë¶€ í•¨ìˆ˜ì˜ ìŠ¤ì½”í”„ë¥¼ ê¸°ì–µí•˜ë¯€ë¡œ ì „ì—­ ìŠ¤ì½”í”„ì™€ëŠ” ë‹¤ë¦…ë‹ˆë‹¤."
            },
            // Level 4 - ì „ë¬¸ê°€
            {
                id: 9,
                level: 4,
                question: "ë‹¤ìŒ ì½”ë“œì˜ ì¶œë ¥ ê²°ê³¼ëŠ”?\n\nconst arr = [1, 2, 3, 4, 5];\nconst result = arr.reduce((acc, curr) => acc + curr, 0);\nconsole.log(result);",
                options: ["15", "10", "5", "ì—ëŸ¬"],
                correctAnswer: 0,
                explanation: "reduce ë©”ì„œë“œëŠ” ë°°ì—´ì˜ ëª¨ë“  ìš”ì†Œë¥¼ í•˜ë‚˜ì˜ ê°’ìœ¼ë¡œ ì¶•ì•½í•©ë‹ˆë‹¤."
            },
            {
                id: 10,
                level: 4,
                question: "ë‹¤ìŒ ì¤‘ React Hookì´ ì•„ë‹Œ ê²ƒì€?",
                options: ["useState", "useEffect", "useContext", "useComponent"],
                correctAnswer: 3,
                explanation: "useComponentëŠ” React Hookì´ ì•„ë‹™ë‹ˆë‹¤."
            },
            // Level 5 - ë§ˆìŠ¤í„°
            {
                id: 11,
                level: 5,
                question: "ë‹¤ìŒ ì½”ë“œì˜ ì¶œë ¥ ê²°ê³¼ëŠ”?\n\nconst generator = function* () {\n  yield 1;\n  yield 2;\n  yield 3;\n};\nconst gen = generator();\nconsole.log(gen.next().value);",
                options: ["1", "2", "3", "undefined"],
                correctAnswer: 0,
                explanation: "ì œë„ˆë ˆì´í„° í•¨ìˆ˜ëŠ” yield í‚¤ì›Œë“œë¡œ ê°’ì„ ë°˜í™˜í•˜ê³  ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ë‹¨í•©ë‹ˆë‹¤."
            },
            {
                id: 12,
                level: 5,
                question: "ë‹¤ìŒ ì¤‘ ë©”ëª¨ì´ì œì´ì…˜ íŒ¨í„´ì´ ì•„ë‹Œ ê²ƒì€?",
                options: ["React.memo", "useMemo", "useCallback", "useRef"],
                correctAnswer: 3,
                explanation: "useRefëŠ” ë©”ëª¨ì´ì œì´ì…˜ê³¼ ê´€ë ¨ì´ ì—†ëŠ” Hookì…ë‹ˆë‹¤."
            }
        ];

        let currentQuestion = 0;
        let selectedAnswer = null;
        let answers = [];
        let isTestComplete = false;

        function renderQuestion() {
            const question = testQuestions[currentQuestion];
            const progress = ((currentQuestion + 1) / testQuestions.length) * 100;
            
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1} / ${testQuestions.length}`;

            const levelNames = ['ì´ˆë³´ì', 'ì‰¬ì›€', 'ë³´í†µ', 'ì–´ë ¤ì›€', 'ì „ë¬¸ê°€', 'ë§ˆìŠ¤í„°'];
            
            const questionHTML = `
                <div class="question-card">
                    <div class="question-header">
                        <span class="level-indicator">Level ${question.level}</span>
                        <span class="difficulty">${levelNames[question.level]}</span>
                    </div>
                    
                    <div class="question-content">
                        <h3>${question.question}</h3>
                    </div>

                    <div class="options">
                        ${question.options.map((option, index) => `
                            <button class="option-btn ${selectedAnswer === index ? 'selected' : ''}" 
                                    onclick="selectAnswer(${index})">
                                <span class="option-letter">${String.fromCharCode(65 + index)}</span>
                                <span class="option-text">${option}</span>
                            </button>
                        `).join('')}
                    </div>

                    <div class="text-center">
                        <button class="btn btn-primary" 
                                onclick="nextQuestion()" 
                                ${selectedAnswer === null ? 'disabled' : ''}>
                            ${currentQuestion === testQuestions.length - 1 ? 'í…ŒìŠ¤íŠ¸ ì™„ë£Œ' : 'ë‹¤ìŒ ë¬¸ì œ'}
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('testContainer').innerHTML = questionHTML;
        }

        function selectAnswer(answerIndex) {
            selectedAnswer = answerIndex;
            renderQuestion();
        }

        function nextQuestion() {
            if (selectedAnswer !== null) {
                answers.push(selectedAnswer);
                
                if (currentQuestion < testQuestions.length - 1) {
                    currentQuestion++;
                    selectedAnswer = null;
                    renderQuestion();
                } else {
                    showResult();
                }
            }
        }

        function calculateResult() {
            let correctCount = 0;
            let totalScore = 0;
            
            answers.forEach((answer, index) => {
                const question = testQuestions[index];
                if (answer === question.correctAnswer) {
                    correctCount++;
                    totalScore += question.level + 1;
                }
            });

            const averageScore = totalScore / testQuestions.length;
            const determinedLevel = Math.min(5, Math.max(0, Math.floor(averageScore)));

            return {
                level: determinedLevel,
                score: totalScore,
                totalQuestions: testQuestions.length,
                correctAnswers: correctCount
            };
        }

        function showResult() {
            const result = calculateResult();
            const levelNames = ['ì´ˆë³´ì', 'ì‰¬ì›€', 'ë³´í†µ', 'ì–´ë ¤ì›€', 'ì „ë¬¸ê°€', 'ë§ˆìŠ¤í„°'];
            
            const resultHTML = `
                <div class="result-card">
                    <h2>ğŸ‰ ë ˆë²¨í…ŒìŠ¤íŠ¸ ì™„ë£Œ!</h2>
                    <div class="level-badge">
                        <span class="level-number">Level ${result.level}</span>
                        <span class="level-description">${levelNames[result.level]}</span>
                    </div>
                    <div class="score-details">
                        <p>ì •ë‹µë¥ : ${Math.round((result.correctAnswers / result.totalQuestions) * 100)}%</p>
                        <p>ë§íŒ ë¬¸ì œ: ${result.correctAnswers}/${result.totalQuestions}</p>
                        <p>ì´ ì ìˆ˜: ${result.score}ì </p>
                    </div>
                    <div class="result-actions">
                        <button class="btn btn-primary" onclick="submitResult()">
                            ê²°ê³¼ ì €ì¥í•˜ê¸°
                        </button>
                        <button class="btn btn-secondary" onclick="resetTest()">
                            ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('testContainer').innerHTML = resultHTML;
            isTestComplete = true;
        }

        function submitResult() {
            const result = calculateResult();
            
            fetch('/api/level-test', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    level: result.level,
                    score: result.score,
                    totalQuestions: result.totalQuestions,
                    correctAnswers: result.correctAnswers,
                    answers: answers
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('ë ˆë²¨í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    window.location.href = '/home';
                } else {
                    throw new Error(data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ê²°ê³¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        }

        function resetTest() {
            currentQuestion = 0;
            selectedAnswer = null;
            answers = [];
            isTestComplete = false;
            renderQuestion();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²« ë²ˆì§¸ ë¬¸ì œ ë Œë”ë§
        document.addEventListener('DOMContentLoaded', function() {
            renderQuestion();
        });
    </script>
</body>
</html>
