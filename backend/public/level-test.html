<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>레벨테스트 - Gpters</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .level-test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .test-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .test-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .question-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .level-indicator {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .question-content h3 {
            color: #2c3e50;
            font-size: 1.3rem;
            line-height: 1.6;
            margin-bottom: 25px;
            white-space: pre-line;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .option-btn {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1rem;
        }
        
        .option-btn:hover {
            border-color: #3498db;
            background-color: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
        }
        
        .option-btn.selected {
            border-color: #3498db;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .option-letter {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            font-weight: 600;
            margin-right: 15px;
            font-size: 0.9rem;
        }
        
        .option-btn.selected .option-letter {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            min-width: 150px;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #2980b9, #1f4e79);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .btn-primary:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 40px;
            text-align: center;
        }
        
        .level-number {
            display: block;
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .score-details {
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .score-details p {
            margin: 8px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        @media (max-width: 768px) {
            .level-test-container {
                padding: 15px;
            }
            
            .test-header h1 {
                font-size: 2rem;
            }
            
            .question-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="level-test-container">
        <div class="test-header">
            <h1>🎯 레벨테스트</h1>
            <p>당신의 프로그래밍 실력을 측정해보세요!</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div id="questionCounter">1 / 12</div>
        </div>

        <div id="testContainer">
            <!-- 테스트 문제들이 여기에 동적으로 생성됩니다 -->
        </div>
    </div>

    <script>
        // 레벨테스트 문제 데이터
        const testQuestions = [
            // Level 0 - 초보자
            {
                id: 1,
                level: 0,
                question: "다음 중 변수 선언 방법이 올바른 것은?",
                options: [
                    "var name = 'John';",
                    "name = 'John';",
                    "let name = 'John';",
                    "const name = 'John';"
                ],
                correctAnswer: 2,
                explanation: "let과 const는 ES6에서 도입된 블록 스코프 변수 선언 방법입니다."
            },
            {
                id: 2,
                level: 0,
                question: "JavaScript에서 함수를 선언하는 방법은?",
                options: [
                    "function myFunc() {}",
                    "const myFunc = () => {}",
                    "var myFunc = function() {}",
                    "모두 올바름"
                ],
                correctAnswer: 3,
                explanation: "JavaScript에서는 여러 방법으로 함수를 선언할 수 있습니다."
            },
            // Level 1 - 쉬움
            {
                id: 3,
                level: 1,
                question: "다음 코드의 출력 결과는?\n\nconst arr = [1, 2, 3];\nconsole.log(arr.length);",
                options: ["2", "3", "4", "undefined"],
                correctAnswer: 1,
                explanation: "배열의 length 속성은 배열의 요소 개수를 반환합니다."
            },
            {
                id: 4,
                level: 1,
                question: "다음 중 배열 메서드가 아닌 것은?",
                options: ["push()", "pop()", "length()", "shift()"],
                correctAnswer: 2,
                explanation: "length는 메서드가 아닌 속성입니다."
            },
            // Level 2 - 보통
            {
                id: 5,
                level: 2,
                question: "다음 코드의 출력 결과는?\n\nconst obj = { a: 1, b: 2 };\nconst { a, b } = obj;\nconsole.log(a + b);",
                options: ["3", "12", "undefined", "에러"],
                correctAnswer: 0,
                explanation: "구조 분해 할당을 통해 객체의 속성을 변수로 추출할 수 있습니다."
            },
            {
                id: 6,
                level: 2,
                question: "Promise의 상태가 아닌 것은?",
                options: ["pending", "fulfilled", "rejected", "resolved"],
                correctAnswer: 3,
                explanation: "Promise의 상태는 pending, fulfilled, rejected입니다."
            },
            // Level 3 - 어려움
            {
                id: 7,
                level: 3,
                question: "다음 코드의 출력 결과는?\n\nasync function test() {\n  const result = await Promise.resolve(42);\n  return result * 2;\n}\ntest().then(console.log);",
                options: ["42", "84", "undefined", "Promise"],
                correctAnswer: 1,
                explanation: "async/await를 사용하여 Promise를 처리하고 결과를 반환합니다."
            },
            {
                id: 8,
                level: 3,
                question: "클로저(Closure)의 특징이 아닌 것은?",
                options: [
                    "외부 함수의 변수에 접근 가능",
                    "메모리 누수 가능성",
                    "전역 변수와 동일한 스코프",
                    "함수가 선언된 환경을 기억"
                ],
                correctAnswer: 2,
                explanation: "클로저는 외부 함수의 스코프를 기억하므로 전역 스코프와는 다릅니다."
            },
            // Level 4 - 전문가
            {
                id: 9,
                level: 4,
                question: "다음 코드의 출력 결과는?\n\nconst arr = [1, 2, 3, 4, 5];\nconst result = arr.reduce((acc, curr) => acc + curr, 0);\nconsole.log(result);",
                options: ["15", "10", "5", "에러"],
                correctAnswer: 0,
                explanation: "reduce 메서드는 배열의 모든 요소를 하나의 값으로 축약합니다."
            },
            {
                id: 10,
                level: 4,
                question: "다음 중 React Hook이 아닌 것은?",
                options: ["useState", "useEffect", "useContext", "useComponent"],
                correctAnswer: 3,
                explanation: "useComponent는 React Hook이 아닙니다."
            },
            // Level 5 - 마스터
            {
                id: 11,
                level: 5,
                question: "다음 코드의 출력 결과는?\n\nconst generator = function* () {\n  yield 1;\n  yield 2;\n  yield 3;\n};\nconst gen = generator();\nconsole.log(gen.next().value);",
                options: ["1", "2", "3", "undefined"],
                correctAnswer: 0,
                explanation: "제너레이터 함수는 yield 키워드로 값을 반환하고 실행을 일시 중단합니다."
            },
            {
                id: 12,
                level: 5,
                question: "다음 중 메모이제이션 패턴이 아닌 것은?",
                options: ["React.memo", "useMemo", "useCallback", "useRef"],
                correctAnswer: 3,
                explanation: "useRef는 메모이제이션과 관련이 없는 Hook입니다."
            }
        ];

        let currentQuestion = 0;
        let selectedAnswer = null;
        let answers = [];
        let isTestComplete = false;

        function renderQuestion() {
            const question = testQuestions[currentQuestion];
            const progress = ((currentQuestion + 1) / testQuestions.length) * 100;
            
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1} / ${testQuestions.length}`;

            const levelNames = ['초보자', '쉬움', '보통', '어려움', '전문가', '마스터'];
            
            const questionHTML = `
                <div class="question-card">
                    <div class="question-header">
                        <span class="level-indicator">Level ${question.level}</span>
                        <span class="difficulty">${levelNames[question.level]}</span>
                    </div>
                    
                    <div class="question-content">
                        <h3>${question.question}</h3>
                    </div>

                    <div class="options">
                        ${question.options.map((option, index) => `
                            <button class="option-btn ${selectedAnswer === index ? 'selected' : ''}" 
                                    onclick="selectAnswer(${index})">
                                <span class="option-letter">${String.fromCharCode(65 + index)}</span>
                                <span class="option-text">${option}</span>
                            </button>
                        `).join('')}
                    </div>

                    <div class="text-center">
                        <button class="btn btn-primary" 
                                onclick="nextQuestion()" 
                                ${selectedAnswer === null ? 'disabled' : ''}>
                            ${currentQuestion === testQuestions.length - 1 ? '테스트 완료' : '다음 문제'}
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('testContainer').innerHTML = questionHTML;
        }

        function selectAnswer(answerIndex) {
            selectedAnswer = answerIndex;
            renderQuestion();
        }

        function nextQuestion() {
            if (selectedAnswer !== null) {
                answers.push(selectedAnswer);
                
                if (currentQuestion < testQuestions.length - 1) {
                    currentQuestion++;
                    selectedAnswer = null;
                    renderQuestion();
                } else {
                    showResult();
                }
            }
        }

        function calculateResult() {
            let correctCount = 0;
            let totalScore = 0;
            
            answers.forEach((answer, index) => {
                const question = testQuestions[index];
                if (answer === question.correctAnswer) {
                    correctCount++;
                    totalScore += question.level + 1;
                }
            });

            const averageScore = totalScore / testQuestions.length;
            const determinedLevel = Math.min(5, Math.max(0, Math.floor(averageScore)));

            return {
                level: determinedLevel,
                score: totalScore,
                totalQuestions: testQuestions.length,
                correctAnswers: correctCount
            };
        }

        function showResult() {
            const result = calculateResult();
            const levelNames = ['초보자', '쉬움', '보통', '어려움', '전문가', '마스터'];
            
            const resultHTML = `
                <div class="result-card">
                    <h2>🎉 레벨테스트 완료!</h2>
                    <div class="level-badge">
                        <span class="level-number">Level ${result.level}</span>
                        <span class="level-description">${levelNames[result.level]}</span>
                    </div>
                    <div class="score-details">
                        <p>정답률: ${Math.round((result.correctAnswers / result.totalQuestions) * 100)}%</p>
                        <p>맞힌 문제: ${result.correctAnswers}/${result.totalQuestions}</p>
                        <p>총 점수: ${result.score}점</p>
                    </div>
                    <div class="result-actions">
                        <button class="btn btn-primary" onclick="submitResult()">
                            결과 저장하기
                        </button>
                        <button class="btn btn-secondary" onclick="resetTest()">
                            다시 테스트하기
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('testContainer').innerHTML = resultHTML;
            isTestComplete = true;
        }

        function submitResult() {
            const result = calculateResult();
            
            fetch('/api/level-test', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    level: result.level,
                    score: result.score,
                    totalQuestions: result.totalQuestions,
                    correctAnswers: result.correctAnswers,
                    answers: answers
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('레벨테스트 결과가 저장되었습니다!');
                    window.location.href = '/home';
                } else {
                    throw new Error(data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('결과 저장 중 오류가 발생했습니다.');
            });
        }

        function resetTest() {
            currentQuestion = 0;
            selectedAnswer = null;
            answers = [];
            isTestComplete = false;
            renderQuestion();
        }

        // 페이지 로드 시 첫 번째 문제 렌더링
        document.addEventListener('DOMContentLoaded', function() {
            renderQuestion();
        });
    </script>
</body>
</html>
