<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>설문조사</title>
</head>
<body>
  <h1>설문조사</h1>
  <form id="survey-form">
    <label>현재 직업이 무엇인가요?:
      <input type="text" name="job_title" required>
    </label><br><br>

    <label>학습 목적이 무엇인가요?:
      <textarea name="learning_purpose" required></textarea>
    </label><br><br>

    <label>본인이 생각하는 실력을 눌러주세요:
      <select name="current_skill_level" required>
        <option value="1">입문</option>
        <option value="2">초급</option>
        <option value="3">중급</option>
        <option value="4">상급</option>
        <option value="5">전문가</option>
      </select>
    </label><br><br>

    <label>코딩을 배우는 동기부여가 있을까요?:
      <textarea name="motivation"></textarea>
    </label><br><br>

    <label>주당 학습 가능 시간을 눌러주세요:
      <select name="time_availability" required>
        <option value="1시간 미만">1시간 미만</option>
        <option value="1~5시간">1~5시간</option>
        <option value="5~10시간">5~10시간</option>
        <option value="10시간 이상">10시간 이상</option>
      </select>
    </label><br><br>

    <label>선호하는 언어를 입력해주세요(없으면 기타를 눌러주세요):
      <select name="preferred_language" required>
        <option value="Python">Python</option>
        <option value="JavaScript">JavaScript</option>
        <option value="C++">C++</option>
        <option value="Java">Java</option>
        <option value="기타">기타</option>
      </select>
    </label><br><br>

    <button type="submit">제출하기</button>
  </form>

  <script>
    document.getElementById('survey-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const token = localStorage.getItem('token');
      if (!token) {
        alert('로그인이 필요합니다.');
        return;
      }

      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());

      try {
        const res = await fetch('/survey/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(data)
        });

        const result = await res.json();
        if (res.ok) {
          alert('✅ 설문이 성공적으로 제출되었습니다!');
          window.location.href = '/home';
        } else {
          alert('❌ ' + result.message);
        }
      } catch (err) {
        alert('서버 오류: ' + err.message);
      }
    });
  </script>
</body>
</html>
